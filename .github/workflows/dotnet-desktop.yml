name: .Net Core Maui Build

on: 
  push:
    branches: ["master"]
  pull_request:
    branches: ["master"]

jobs:

  build_blazor_hybrid_windows:
    name: build blazor hybrid (Windows)

    strategy:
      matrix:
        configuration: [ Release ]
  
  
    
    runs-on: Windows-latest

    env: 
      # App_Packages_Archive: AppPackages.zip
      # App_Packages_Directory: AppPackages
      # SigningCertificate: GitHubActionsDemo.pfx
      Solution_Path: WordleSolver.csproj
      # Test_Project_Path: MyWpfApp.Tests\MyWpfApp.Tests.csproj
      # Wpf_Project_Path: MyWpfApp\MyWpfApp.csproj
      # Wap_Project_Directory: MyWpfApp.Package
      # Wap_Project_Name: MyWpfApp.Package.wapproj
      # Actions_Allow_Unsecure_Commands: true # Allows AddPAth and SetEnv commands

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      #.Net Core Workload
      - name: Install .Net Core
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 7.0.x

      # Add  MsBuild to the PATH: https://github.com/microsoft/setup-msbuild
      - name: Setup MSBuild.exe
        uses: microsoft/setup-msbuild@v1.1
#         with:
#           msbuild-architecture: x64
        
        
#         Restore the application to populate the obj folder with RuntimeIdentifiers
      - name: Restore the application
        run: msbuild $env:Solution_Name /t:Restore 
        

      

      
      - name: Restore workloads
        run: dotnet workload restore $env:Solution_Path -p:BlazorMode=BlazorHybrid -f net7.0-windows10.0.19041.0
        
      - name: Fix android missing at list
        run: dotnet workload install maui

      - name: Build (To generate CSS/JS files)
        run: dotnet build $env:Solution_Path -p:BlazorMode=BlazorHybrid -p:Configuration=Release -p:WindowsPackageType=None -p:SelfContained=true -p:WindowsAppSDKSelfContained=true -p:GenerateAppxPackageOnBuild=false -p:RuntimeIdentifier=win10-x86 -f net7.0-windows10.0.19041.0
    
      - name: Build exe
        run: dotnet build $env:Solution_Path -p:BlazorMode=BlazorHybrid -p:Configuration=Release -p:WindowsPackageType=None -p:SelfContained=true -p:WindowsAppSDKSelfContained=true -p:GenerateAppxPackageOnBuild=false -p:RuntimeIdentifier=win10-x86 -f net7.0-windows10.0.19041.0
    
      
        
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: my-artifact
          path: bin/release/net7.0-windows10.0.19041.0/win10-x64
          if-no-files-found: error # 'warn' or 'ignore' are also available, defaults to `warn`
